
name: Hourly Health Check

on:
  schedule:
    - cron: "0 * * * *"   
  workflow_dispatch:      

jobs:
  health_check:
    runs-on: ubuntu-latest
    steps:
      - name: Check the deployed service URL
        uses: jtalk/url-health-check-action@v4
        with:
          url: https://phonebook-backend-13q6.onrender.com/health
          follow-redirect: false 
          max-attempts: 3
          retry-delay: 10s
          retry-all: true
      - name: The job has FAILED
        if: ${{ failure() }}
        uses: rjstone/discord-webhook-notify@v2
        with:
          webhookUrl: ${{ secrets.DISCORD_HOOK_URL }}
          username: Sten Stensson
          avatarUrl: "https://media.istockphoto.com/id/184600247/photo/grumpy-senior-man.jpg?s=612x612&w=0&k=20&c=_mBQPDcq1E3Vyz5uiw8QnwAikXVcdtiRChvrMUyuzRw="
          text: " Deployment FAILED!!!!!!!!!!"
          severity: info 
          color: '#C7371A'
          title: EPIC FAIL!
          description: "Deployment FAILED"
          footer: Do better!.